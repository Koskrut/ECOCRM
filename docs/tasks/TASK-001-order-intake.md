# TASK-001: Order intake (заказ + товары)

## Goal
Сделать первый рабочий вертикальный срез CRM:
- backend API для заказов и товаров
- frontend: список заказов
- открытие карточки заказа в модальном окне
- добавление товаров в заказ

Это база для Новой Почты, оплат и автостатусов.

---

## Scope
### Входит
- Order
- OrderItem
- Product (минимально)
- создание заказа
- добавление / редактирование / удаление товаров
- пересчет суммы заказа
- история статусов (минимум: создание)

### Не входит
- Новая Почта
- Privat24
- роли и сложные права
- отчеты
- мобилки

---

## Acceptance Criteria

### Backend (NestJS)
- POST `/orders`
  - создает заказ
  - статус = `NEW`
- GET `/orders`
  - список заказов
  - пагинация
- GET `/orders/:id`
  - заказ + items
- POST `/orders/:id/items`
  - добавляет товар (productId, qty, price)
- PATCH `/orders/:id/items/:itemId`
  - меняет qty / price
- DELETE `/orders/:id/items/:itemId`
  - удаляет позицию
- total заказа пересчитывается автоматически
- создается запись в OrderStatusHistory

---

### Frontend (Next.js)
- `/orders` — таблица заказов
- клик по строке → открывает **модальную карточку заказа**
- в модалке:
  - список товаров
  - кнопка “Add item”
- после добавления товара сумма обновляется без перезагрузки
- URL поддерживает deep-link (например `/orders?orderId=123`)

---

## Rules
- Следовать `docs/PRD.md`
- Следовать `docs/DOMAIN.md`
- Следовать `docs/UX.md`
- Не добавлять зависимости
- TypeScript strict
- Изменение статуса только через сервис статусов
