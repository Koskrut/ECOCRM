# CRM — UX (MVP)

Версия: 1.0  
Дата: 2026-02-02  
Файл: `docs/UX.md`

---

## 0. Принципы UX

1. **Скорость**: главные действия должны делаться за 1–2 экрана, без лишних переходов.
2. **Минимум кликов**: создание заказа и ТТН — ключевой поток.
3. **Модалки вместо ухода со страницы**: Company/Client/Order открываются в модальных окнах (или drawer).
4. **Единый таймлайн**: все действия менеджера + системные события в одном месте.
5. **Понятные статусы**: OrderStatus = этап исполнения (fulfillment), оплаты — бейдж `Unpaid/Partial/Paid`.
6. **Предсказуемость**: кнопки действий всегда в одном месте, одинаковые паттерны сохранения.
7. **Защита от ошибок**: валидация до интеграций, подтверждения для опасных действий, автосохранение черновиков (опц.).

---

## 1. Информационная архитектура (MVP)

### Основные разделы

- **Orders**
- **Companies**
- **Payments (Review)** (только TeamLead)
- **Products** (если включено)
- **Settings** (если включено)

### Быстрые глобальные действия (в шапке)

- Global Search: заказ/компания/контакт/ТТН/телефон
- “Создать заказ”
- (опц.) “Создать компанию/контакт”

---

## 2. Глобальные компоненты UI

### 2.1 Global Search

**Поле поиска** в верхней панели:

- ищет по: `order_number`, `company.name`, `client.phone`, `client.email`, `shipment.ttn_number`, `payment.transaction_id`
- результаты в dropdown:
  - Order (№, сумма, статус, бейдж оплаты)
  - Company (название)
  - Client (ФИО + телефон)
  - Shipment (ТТН)

**Горячие клавиши (опц.)**

- `/` — фокус в поиск
- `N` — создать заказ

---

### 2.2 Бейджи и статусы

**Order card/list показывает:**

- статус исполнения (OrderStatus): NEW / SHIPPING_CREATED / SHIPPED / DELIVERED / CANCELLED
- бейдж оплаты (computed):
  - `UNPAID` (paid_amount = 0)
  - `PARTIAL` (0 < paid_amount < total)
  - `PAID` (paid_amount >= total)
- бейдж интеграций:
  - `TTN` (есть Shipment)
  - `P24` (есть связанные платежи)

---

### 2.3 Модалки / Drawer

Единый паттерн:

- справа drawer (рекомендуется) или модалка
- header: название + важные бейджи
- tabs/sections: Details / Timeline / Related
- footer: кнопки “Сохранить”, “Закрыть”
- закрытие по Esc, подтверждение если есть несохраненные изменения

---

### 2.4 Таймлайн (Activity feed)

**Единый компонент** для Company, Client, Order:

- сортировка: newest first
- фильтр по типу: All / Calls / Meetings / Notes / System
- быстрые действия: “Звонок”, “Встреча”, “Заметка”
- каждый элемент:
  - иконка типа
  - заголовок (subject)
  - мета: автор, дата/время
  - body: описание, outcome
  - (опц.) ссылка на связанный заказ/ТТН/платеж

---

## 3. Orders

## 3.1 Orders List (экран)

**Цель:** быстро найти и открыть заказ, видеть состояние по доставке и оплате.

### Layout

- верх: фильтры + поиск
- середина: таблица/лист заказов
- справа (опц.): мини-панель статистики

### Колонки (минимум)

- № заказа (кликабельно — drawer Order)
- Компания / Контакт
- Сумма
- Статус (fulfillment)
- Оплата (бейдж + paid/total)
- Менеджер (видно TeamLead)
- Дата создания
- (опц.) ТТН

### Фильтры

- период: today / 7d / 30d / custom
- статус: NEW / SHIPPING_CREATED / SHIPPED / DELIVERED / CANCELLED
- оплата: UNPAID / PARTIAL / PAID
- менеджер (только TeamLead)
- “Есть ТТН” (checkbox)

### Основные действия

- “Создать заказ” (primary)
- bulk actions в MVP не нужны

### Empty states

- нет заказов: кнопка “Создать первый заказ”
- нет результатов: подсказка сбросить фильтры

---

## 3.2 Create / Edit Order (drawer)

**Цель:** создать заказ за 1–2 минуты.

### Структура drawer

1. **Header**

- Order № (если создан)
- Status + Payment badge
- быстрые кнопки: “Создать ТТН”, “Добавить оплату (manual)” (если разрешено), “Отменить” (TeamLead)

2. **Customer block**

- Company selector (autocomplete + create in modal)
- Client selector (autocomplete + create in modal)
- контактные данные (телефон) — рядом кнопка “Звонок”

3. **Items block**

- строка добавления товара:
  - Product autocomplete
  - Qty
  - Price (авто из base_price, редактируемо)
  - Add button
- таблица позиций:
  - Product, Qty, Price, Line total, remove
- итоги:
  - subtotal, discount, total

4. **Shipment summary**

- если Shipment нет: CTA “Создать ТТН”
- если есть: ТТН номер, статус доставки, “Открыть/Печать” (если будет)

5. **Payments summary**

- список платежей (дата, сумма, источник, статус)
- итоги
- если есть NEEDS_REVIEW — бейдж + ссылка (TeamLead)

6. **Timeline**

- встроенный feed (последние 10)
- кнопка “Открыть весь таймлайн”

### Валидация (минимум)

- Company обязательна
- Client обязателен (или минимум телефон получателя/контакта)
- хотя бы 1 позиция OrderItem
- qty > 0, price >= 0

### Сохранение

- primary: “Сохранить”
- автосохранение черновика (опц.)
- уведомления toast: Saved / Error

---

## 3.3 Create Shipment (ТТН) из Order

**Цель:** создать ТТН без повторного ввода данных.

### Поток

- из Order drawer → “Создать ТТН”
- открывается modal/drawer формы доставки
- поля подставляются из Company/Client (если есть)

### Поля (MVP)

- Recipient name (из Client или вручную)
- Recipient phone (из Client)
- Delivery type: Branch / Address
- Branch (если Branch) / Address text (если Address)
- Payer: Sender / Recipient
- COD amount (наложка) (опц.)
- Comment (опц.)

### UX правила

- обязательные поля подсвечиваются
- кнопка “Создать ТТН” disabled пока форма невалидна
- success state:
  - показать ТТН номер
  - кнопки: “Скопировать”, “Печать/Ссылка” (если доступно)
  - автоматически обновить Order drawer

### Ошибки

- показать человеко-понятное сообщение
- внизу “Технические детали” раскрывающимся блоком (опц.)
- ретрай кнопка

---

## 4. Companies & Clients

## 4.1 Companies List

Колонки:

- Company name
- Primary contact (phone)
- Manager (owner)
- Последний заказ (дата/сумма)
- Последняя активность (call/meeting/note)

Фильтры:

- менеджер
- “без активности 14 дней” (полезно руководителю)
- поиск по названию/телефону

---

## 4.2 Company Drawer

Секции:

- Header: название + бейдж owner
- Contacts (список клиентов/контактов)
- Quick actions: **Звонок / Встреча / Заметка**
- Recent orders (последние 10)
- Timeline (полный)

### Client Drawer (внутри Company или отдельно)

- поля контакта
- быстрые кнопки: CALL / MEETING / NOTE
- мини-история заказов
- таймлайн (фильтруемый)

---

## 5. Таймлайн: создание действий (CALL/MEETING/NOTE)

## 5.1 CALL (форма)

Поля:

- outcome (select): `No answer / Reached / Callback / Deal / Other`
- duration (сек/мин) (или старт/стоп)
- note (textarea)
- next_step_at (опц.)
- link to order (опц., если вызов из заказа уже проставлено)

UX:

- шаблоны outcome + быстрые заметки (опц.)
- сохранение → появляется в feed сразу

---

## 5.2 MEETING (форма)

Поля:

- start_at (обяз.)
- end_at (опц.) или duration
- location (text) (опц.)
- outcome (select/строка)
- note
- next_step_at (опц.)

UX:

- выбор даты/времени быстрый (date-time picker)
- после сохранения показывать “следующий шаг” вверху таймлайна (если задан)

---

## 5.3 NOTE (форма)

Поля:

- subject (опц., автоген “Note”)
- note (обяз.)
- (опц.) next_step_at

---

## 6. Payments Review (TeamLead)

**Цель:** быстро разобрать сомнительные оплаты.

### Layout

- список оплат NEEDS_REVIEW слева
- панель деталей справа

### В списке

- дата/время
- сумма
- sender (если есть)
- snippet description
- бейдж “possible matches: N”

### В панели деталей

- детали платежа + raw description
- блок “Предлагаемые заказы” (top 5):
  - order_number, company, сумма долга, дата, score
- действия:
  - “Привязать к заказу” (select)
  - “Отклонить” (с причиной)
  - “Комментарий”

После действия:

- PaymentStatus меняется, заказ пересчитывается, в Order/Company таймлайн добавляется SYSTEM событие

---

## 7. Ошибки и состояния

### 7.1 Loading состояния

- skeleton rows в списках
- в drawer: skeleton header + sections

### 7.2 Ошибки интеграций

- показывать компактный баннер в Order/Shipment блоке:
  - “Не удалось обновить статус доставки. Повторить.”
- TeamLead/Admin может видеть подробности (attempts, last_error)

### 7.3 Конфликты/блокировки

- если два пользователя редактируют Order:
  - оптимистичная блокировка по updated_at
  - при конфликте: “Ваши изменения не сохранены, потому что заказ был изменен…”
  - предложить “перезагрузить” или “скопировать изменения” (опц.)

---

## 8. Мобильная адаптация (web)

В MVP минимальная:

- Orders List: карточки вместо таблицы
- Drawer на весь экран
- быстрые действия CALL/MEETING крупными кнопками

---

## 9. UX мелочи, которые сильно помогают

- “Скопировать номер ТТН” одним кликом
- “Позвонить” из контакта (если на мобильном — tel:)
- автоподстановка последней цены клиенту (подсказка)
- “Недавно использованные товары” (для ускорения)
- быстрые фильтры: “Сегодня”, “Без оплаты”, “Без ТТН”
- в таймлайне показывать “Следующий шаг” отдельной строкой

---

## 10. Acceptance Criteria (MVP)

- Менеджер создает заказ с 3–5 позициями ≤ 2 минуты.
- Менеджер создает ТТН из заказа ≤ 1 минуты при наличии данных.
- Таймлайн клиента отображает: CALL/MEETING/NOTE и SYSTEM события.
- Руководитель разбирает оплату и привязывает к заказу ≤ 30 секунд.
- Orders List открывается быстро, есть пагинация и поиск.
